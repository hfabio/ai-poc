(function(){"use strict";const{GestureDescription:i,Finger:t,FingerCurl:n}=self.fp,u=new i("scroll-down"),g=new i("scroll-up"),c=new i("rock-and-roll"),d=new i("click");u.addCurl(t.Thumb,n.HalfCurl,1),u.addCurl(t.Thumb,n.NoCurl,.5);for(let e of[t.Index,t.Middle,t.Ring,t.Pinky])u.addCurl(e,n.FullCurl,1),u.addCurl(e,n.HalfCurl,.9);for(const e of t.all)g.addCurl(e,n.NoCurl,1);for(const e of[t.Thumb,t.Index,t.Pinky])c.addCurl(e,n.NoCurl,1),c.addCurl(e,n.NoCurl,.9);for(const e of[t.Middle,t.Ring])c.addCurl(e,n.FullCurl,1),c.addCurl(e,n.FullCurl,.9);d.addCurl(t.Index,n.HalfCurl,.8),d.addCurl(t.Index,n.FullCurl,.5),d.addCurl(t.Thumb,n.NoCurl,1),d.addCurl(t.Thumb,n.HalfCurl,.4);for(let e of[t.Middle,t.Ring,t.Pinky])d.addCurl(e,n.HalfCurl,1),d.addCurl(e,n.FullCurl,.9);const w=[u,g,d,c],k={"scroll-up":"🖐","scroll-down":"✊️",click:"🤏","rock-and-roll":"🤟"},y=async(e,a)=>{const l=a.map(({x:r,y:s,z:f})=>[r,s,f]);return(await e.estimate(l,9)).gestures},M=async({predictions:e,gestureEstimator:a})=>{let l=[],o=[];if(!(e!=null&&e.length))return{gestures:l,events:o};for(const r of e){if(!r.keypoints3D)continue;const s=await y(a,r.keypoints3D);if(!(s!=null&&s.length))continue;const f=s.reduce((C,h)=>C.score>h.score?C:h),{x:P,y:R}=r.keypoints.find(({name:C})=>C==="index_finger_tip");o.push({event:f.name,x:P,y:R}),console.log(`detected ${k[f.name]} on ${r.handedness} hand`)}return{gestures:l,events:o}},D=async({video:e,detector:a,estimator:l})=>{const o=a.estimateHands(e,{flipHorizontal:!0});return await M({predictions:o,gestureEstimator:l})},G="https://cdn.jsdelivr.net/npm/@mediapipe/hands",{VERSION:H,handPoseDetection:m,fp:p}=self,E=m.SupportedModels.MediaPipeHands,F={runtime:"mediapipe",solutionPath:`${G}@${H}`,modelType:"lite"};(async()=>{console.log("loading hands tf model");try{const e=await m.createDetector(E,F),a=new p.GestureEstimator(w);console.log("hands tf model loaded"),postMessage("MODEL READY"),onmessage=async({data:l})=>{var r,s;const o=await D({video:l,detector:e,estimator:a,fingerPose:p});!((r=o==null?void 0:o.gestures)!=null&&r.length)&&!((s=o==null?void 0:o.gestures)!=null&&s.length)||postMessage(o)}}catch(e){throw console.log("error on worker",e),postMessage({error:e}),e}})()})();
